<% if journal.contacts && journal.contacts.any? && User.current.allowed_to?(:view_mail_data, @project) %>
  <p class="contact_journal">
    <span class="icon <%= journal.contact_journals.first.is_incoming? ? 'icon-email' : 'icon-email-to' %>">
      <%= journal.contact_journals.first.is_incoming? ? l(:label_received_from) : l(:label_sent_to) %>
    </span>
    <% journal.contact_journals.each do |contact_journal| %>
      <span class="contact" style="white-space: nowrap;display: inline-block;">
      <%= link_to(avatar_to(contact_journal.contact, :size => "16"),  contact_url(contact_journal.contact), :class => "avatar") + ' ' + link_to_source(contact_journal.contact) %>
      (<%= contact_journal.email %>)
      </span>
    <% end %>  
    
    <% if journal.contact_journals.first.is_incoming?  && journal.contact_journals.first.attachments.any? %>
      <% attachment = journal.contact_journals.first.attachments.first %>
      <span class="attachment" style="white-space: nowrap;display: inline-block;">
        <%= link_to_attachment attachment, :text => l(:label_helpdesk_original), :class => 'icon icon-attachment' -%>
        <%= h(" - #{attachment.description}") unless attachment.description.blank? %>
          <span class="size">(<%= number_to_human_size attachment.filesize %>)</span>
          <%= link_to_if_authorized image_tag('magnifier.png', :plugin => "redmine_contacts_helpdesk"),
                :controller => 'contacts_helpdesks', :action => 'show_original',
                :id => attachment, :project_id => @project %>
      </span>  
    <% end %>
  </p>
<% end %>  

