<% content_for :header_tags do %>
  <%= javascript_include_tag('boards_watchers.js', :plugin => 'redmine_boards_watchers') %>
<% end %>

<div class="tabular">
  <div class="box" id="bw-users">
    <p>
      <label><%= l(:label_issue_watchers) %></label>
      <% @project.users.sort.each do |user| -%>
        <label class="bw-floating"><%= check_box_tag watched_param_name, user.id, watched_obj.watched_by?(user) %> <%=h user %></label>
      <% end -%>
    </p>
  </div>
  <p>
    <%= label_tag 'watcher_search', l(:label_user_search) %>
    <%= text_field_tag 'watcher_search', nil, :size => 40, :onkeyup => "highlightWatchers()" %>
    <span class='bw-check-selected'>
      <%= link_to_function(h(l(:label_bw_check_selected)),"toggleSelectedWatchers('1')") %>
    </span>
    <span class='bw-uncheck-selected'>
      <%= link_to_function(h(l(:label_bw_uncheck_selected)),"toggleSelectedWatchers('0')", :class => 'bw-uncheck-selected') %>
    </span>
  </p>
</div>

<% groups = @project.member_principals.find(:all, :include => [:roles, :principal]).sort.select { |m| true if m.principal.class.name == 'Group' } %>
<div class="tabular">
  <div class="box" id="bw-groups">
    <p class="bw-toggle-link">
      <label><%= l(:label_bw_toggle_group) %></label>
      <%= link_to_function(h(l(:label_bw_toggle_all)),"toggleWatchersCheckBoxes('#{[-1].to_json}','-1')") %>
      <% if groups && groups.size > 0 %>
        <% groups.each do |group| -%>
          <%= link_to_function(h(group.principal),"toggleWatchersCheckBoxes('#{group.principal.users.collect(&:id).to_json}','-1')") %>
        <% end -%>
      <% end %>
    </p>
  </div>
</div>
